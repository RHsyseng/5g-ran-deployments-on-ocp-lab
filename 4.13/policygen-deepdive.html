<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PolicyGen DeepDive :: LAB - 5G RAN Deployments on OpenShift</title>
    <link rel="canonical" href="https://labs.sysdeseng.com/4.13/policygen-deepdive.html">
    <link rel="prev" href="talm.html">
    <link rel="next" href="integration-with-aap.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com/en/solutions/telecommunications" target="_blank"><img src="../_/img/Logo-Red_Hat-A-Reverse-RGB.png" height="40px" alt="Red Hat Telco Solutions"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://labs.sysdeseng.com">LAB - 5G RAN Deployments on OpenShift</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="4.13" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Welcome</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html#contributors">Contributors</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="introduction.html">Introduction</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="introduction.html#lab-aim">Who is this lab aimed at? </a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="introduction.html#lab-software-versions">Lab Software Versions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="acronyms.html">Acronyms used in the lab</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="5g-ran-context.html">5G Ran Context</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="5g-ran-context.html#low-latency">Low Latency</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="5g-ran-context.html#numa-nodes">NUMA Nodes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="5g-ran-context.html#huge-pages">Huge Pages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="5g-ran-context.html#cpu-pinning">CPU Pinning</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="5g-ran-context.html#irq-load-balancing">IRQ Load Balancing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="5g-ran-context.html#dpdk">DPDK</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="5g-ran-context.html#oot-drivers">OoT Drivers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="5g-ran-context.html#cpu-reduction-tuning">Tuning for CPU Reduction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="5g-ran-context.html#vran-accelerators">vRAN Dedicated Accelerators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="5g-ran-context.html#ptp">PTP</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="sno-intro.html">Introduction to Single Node OpenShift (SNO)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="sno-intro.html#5g-ran">5G Radio Access Network</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="sno-intro.html#things-keep-mind">Things to keep in mind</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="sno-intro.html#deployments">Deployments</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="sno-intro.html#extra-information">Extra information</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="telco-related-infra-operators-intro.html">Introduction to Telco Related Infrastructure Operators</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="telco-related-infra-operators-intro.html#node-tuning-operator">Node Tuning Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="telco-related-infra-operators-intro.html#sriov-operator">SR-IOV Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="telco-related-infra-operators-intro.html#ptp-operator">PTP Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="telco-related-infra-operators-intro.html#accelerators-operators">Accelerators Operators</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ztp-intro.html">Introduction to Zero Touch Provisioning (ZTP)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="ocp-gitops.html">OpenShift GitOps</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="ocp-gitops.html#gitops">GitOps</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ocp-gitops.html#gitops-principles">GitOps Principles</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ocp-gitops.html#gitops-patterns-ocp">GitOps Patterns on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ocp-gitops.html#directories-vs-branches">Directories vs Branches</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ocp-gitops.html#direct-commit-to-main">Direct commit to main</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ocp-gitops.html#prs-review-cycles">Pull Requests and review cycles</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ocp-gitops.html#gitops-ocp">GitOps on OpenShift</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="ztp-at-scale.html">Hub Management Components</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="ztp-at-scale.html#rhacm">Red Hat Advanced Cluster Management</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ztp-at-scale.html#mce">Multicluster Engine</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ztp-at-scale.html#ai">Infrastructure Operator</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="ztp-at-scale.html#gitops-operator">GitOps Operator</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ztp-at-scale.html#sitegen">SiteGen</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="ztp-at-scale.html#policygen">PolicyGen</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ztp-at-scale.html#talm">Topology Aware Lifecycle Manager</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="ztp-workflow.html">ZTP Workflow</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="ztp-workflow.html#takeaways">Takeaways</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="rhacm-policies.html">RHACM Policies</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="rhacm-policies.html#policy-framework">Policy Framework</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="rhacm-policies.html#policies">Policies</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="rhacm-policies.html#policy-status">Policy Status</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="rhacm-policies.html#policy-remediation">Policy Remediation</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="managing-at-scale.html">Managing at Scale</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="managing-at-scale.html#inform-policies">Inform Policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="managing-at-scale.html#olm-subscriptions">OLM Subscriptions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="managing-at-scale.html#cluster-policies">Cluster Policies</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="talm.html">Topology Aware Lifecycle Manager (TALM)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="talm.html#inform-policies">Default Inform Policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="talm.html#cgu">Cluster Group Upgrade</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="talm.html#autocreation-cgu">Auto Creation of CGUs</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="talm.html#phase-labels">Phase labels</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="talm.html#waves">Policy Waves</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="talm.html#talm-precache">Precaching</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="talm.html#talm-backup">Backup &amp; Recovery</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="policygen-deepdive.html">PolicyGen Deepdive</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#policygen-implementation">PolicyGen Implementation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#kustomize-plugins">Kustomize Plugins</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#siteconfig-generator">SiteConfigGenerator</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#policy-generator">Policy Generator</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#5g-ran-profile">5G RAN Profile</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#workload-partitioning">Workload Partitioning</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#kubelet-tuning">Kubelet Tuning</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#sctp">SCTP</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#hide-container-mount">Container Mount Hiding</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#recovery-optimization">Recovery Optimization</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#monitoring-footprint">Monitoring Operator Config</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#ocp-console">Console Operator</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#networking-diags">Networking Operator</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#operatorhub">OperatorHub</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#ptp-operator">PTP Operator</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#sr-iov">SR-IOV</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#nto">Node Tuning Operator</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#local-storage">Local Storage</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#logs">Log Collector and Forwarder</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#siteconfig-templating">SiteConfig Templating</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#policies-templating">Policies Templating</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#kustomize-plugins-locally">Running Kustomize Plugins Locally</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="integration-with-aap.html">Integration with Ansible Automation Platform</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="integration-with-aap.html#aap-overview">AAP Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="integration-with-aap.html#augmenting-openshift">Augmenting OpenShift with Ansible Automation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="integration-with-aap.html#intro-to-aap-operator">Introduction to the AAP Operator</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="integration-with-aap.html#aap-components">Defining Components</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="integration-with-aap.html#automation-hub">Automation Hub</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="integration-with-aap.html#automation-controller">Automation Controller</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="integration-with-aap.html#acm-hooks-toward-aap">ACM Hooks Toward AAP</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="integration-with-aap.html#workflow-overview">Workflow Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="integration-with-aap.html#general-workflow">General AAP Integration Workflow</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="integration-with-aap.html#lab-workflow">Lab AAP Integration Workflow</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="deployment-considerations.html">Deployment Considerations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="deployment-considerations.html#hardware-configurations">Hardware configurations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="deployment-considerations.html#bios-settings">Bios Settings</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="deployment-considerations.html#networking">Networking</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="deployment-considerations.html#disconnected-environments">Disconnected Environments</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="deployment-considerations.html#connected-proxy">Connected through proxy</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="deployment-considerations.html#fully-disconnected">Fully disconnected</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="deployment-considerations.html#git-repo-structure">Git Repository Structure</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="lab-environment-introduction.html">Introduction to the Lab Environment</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="lab-environment-introduction.html#git-server">Git Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="lab-environment-introduction.html#container-registry">Container Registry</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="lab-environment-introduction.html#openshift-hub-cluster">OpenShift Hub Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="lab-environment-introduction.html#automation-hub-and-controller">AAP Automation Hub and Automation Controller</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="crafting-deployments-iac.html">Crafting Deployment&#8217;s IaC</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="crafting-deployments-iac.html#introduction-to-siteconfig">Introduction to the SiteConfig</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="crafting-deployments-iac.html#crafting-our-own-siteconfig">Crafting our own SiteConfig</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="crafting-deployments-iac.html#git-repository">Git Repository</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="crafting-deployments-iac.html#baremetal-node-details">Bare Metal Node Details</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="crafting-deployments-iac.html#pre-reqs">Deployment Prerequesites</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="crafting-deployments-iac.html#siteconfig">SiteConfig</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="crafting-cluster-telco-related-infra-operators-configs.html">Crafting Cluster and Telco Related Infrastructure Operators Configs</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="crafting-cluster-telco-related-infra-operators-configs.html#crafting-common-policies">Crafting Common Policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="crafting-cluster-telco-related-infra-operators-configs.html#crafting-group-policies">Crafting Group Policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="crafting-cluster-telco-related-infra-operators-configs.html#crafting-zone-policies">Crafting Zone Policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="crafting-cluster-telco-related-infra-operators-configs.html#crafting-site-policies">Crafting Site Policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="crafting-cluster-telco-related-infra-operators-configs.html#crafting-testing-policies">Crafting testing Policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="crafting-cluster-telco-related-infra-operators-configs.html#configure-kustomization-for-policies">Configure Kustomization for Policies</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="running-the-deployment.html">Running the Deployment</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="running-the-deployment.html#deploying-ztp-gitops-pipeline">Deploying the ZTP GitOps Pipeline</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="running-the-deployment.html#deploying-sno-using-gitops-pipeline">Deploying the SNO Cluster using the ZTP GitOps Pipeline</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="adding-automation.html">Adding Automation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="monitoring-the-deployment.html">Monitoring the Deployment</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="monitoring-the-deployment.html#monitoring-deployment-webui">Monitoring the Deployment via the WebUI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="monitoring-the-deployment.html#monitoring-deployment-cli">Monitoring the Deployment via the CLI</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="managing-existing-clusters.html">Managing Existing Clusters</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="check-deployment-is-finished.html">Check SNO Deployment is finished</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="check-deployment-is-finished.html#check-sno-deployment-webui">Check SNO Deployment has Finished via the WebUI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="check-deployment-is-finished.html#check-sno-deployment-cli">Check SNO Deployment has Finished via the CLI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="check-deployment-is-finished.html#ensure-automation-ran-successfully">Ensure AAP Automation Ran Successfully</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="using-talm-to-update-clusters.html">Using TALM to update clusters</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="using-talm-to-update-clusters.html#verify-talm">Verifying the TALM state</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="using-talm-to-update-clusters.html#upgrade-policy-creation">Creating the upgrade PGT</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="using-talm-to-update-clusters.html#upgrade-cgu-creation">Applying the upgrade</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="using-talm-to-update-clusters.html#talm-backup-precache">Backup and pre-cache</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="using-talm-to-update-clusters.html#talm-upgrade">Triggering the upgrade</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="troubleshooting-tips.html">Troubleshooting Tips</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="troubleshooting-tips.html#verification-lab">Verification of the lab status</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="troubleshooting-tips.html#git-registry">Git repository and registry</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="troubleshooting-tips.html#sno2">SNO2 virtual machine</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="troubleshooting-tips.html#hub">Hub cluster</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="troubleshooting-tips.html#dns">DNS resolution</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="troubleshooting-tips.html#argocd-red">ArgoCD sync not working</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="troubleshooting-tips.html#sno2-down">SNO2 is down after syncing Argo applications</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="troubleshooting-tips.html#policies-blank">Policies not showing in the Governance console</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="troubleshooting-tips.html#policies-not-applied">Policies not applied</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="troubleshooting-tips.html#olm-bug">OLM Bug</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="common-pitfalls.html">Common Pitfalls</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="common-pitfalls.html#exec-probes-cpu-pinning">Exec Probes and CPU Pinning</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="common-pitfalls.html#energy-saving-hw-profiles">Energy Saving Hardware Profiles</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="common-pitfalls.html#secure-boot-oot-unsigned-drivers">Secure Boot and Unsigned OoT Drivers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="common-pitfalls.html#sriov-node-drain">SR-IOV Node Drain</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="common-pitfalls.html#pod-disruption-budgets">Pod Disruption Budgets</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="closing-thoughts.html">Closing Thoughts</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="lab-environment.html">Lab Environment</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="lab-environment.html#lab-requirements">Lab Requirements</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="lab-environment.html#lab-deployment">Lab Deployment</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lab-environment.html#install-kcli">Install kcli</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lab-environment.html#install-oc-kubectl">Install oc/kubectl CLIs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lab-environment.html#configure-disconnected-network">Configure Disconnected Network</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lab-environment.html#configure-local-dns-dhcp-server">Configure Local DNS/DHCP Server</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lab-environment.html#configure-local-dns-as-primary-server">Configure Local DNS as Primary Server</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lab-environment.html#disable-firewall">Disable Firewall</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lab-environment.html#install-ksushytools">Install Ksushy Tool</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lab-environment.html#configure-disconnected-registry">Configure Disconnected Registry</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lab-environment.html#configure-git-server">Configure Git Server</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lab-environment.html#configure-ntp-server">Configure NTP Server</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lab-environment.html#configure-access-to-cluster-apps">Configure Access to Cluster Apps</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lab-environment.html#create-openshift-nodes-vms">Create OpenShift Nodes VMs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lab-environment.html#deploy-openshift-hub-cluster">Deploy OpenShift Hub Cluster</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lab-environment.html#configure-openshift-hub-cluster">Configure OpenShift Hub Cluster</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lab-environment.html#deploy-openshift-hub-cluster-operators">Deploy OpenShift HUB Cluster Operators</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lab-environment.html#deploy-sno1-cluster-without-ztp">Deploy SNO1 Cluster (without ZTP)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="lab-environment.html#configure-aap">Configure AAP</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">LAB - 5G RAN Deployments on OpenShift</a></li>
    <li><a href="policygen-deepdive.html">PolicyGen Deepdive</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/RHsyseng/5g-ran-deployments-on-ocp-lab/edit/lab-4.13/documentation/modules/ROOT/pages/policygen-deepdive.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">PolicyGen DeepDive</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>As we saw in an earlier section of the lab, we can leverage <a href="rhacm-policies.html">RHACM policies</a> to get our clusters configured the way we want. We also introduced the <a href="ztp-at-scale.html#policygen">PolicyGen component</a> which helps us to create a set of policies based on <a href="https://github.com/openshift-kni/cnf-features-deploy/tree/release-4.13/ztp/source-crs">pre-baked templates</a> (source-crs) crafted by the Red Hat CNF team.</p>
</div>
<div class="paragraph">
<p>In this section, we are going to get into the implementation details of the PolicyGen tooling.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="policygen-implementation"><a class="anchor" href="#policygen-implementation"></a>PolicyGen Implementation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The policy generator is implemented as a Kustomize generator plugin. This allows for any Kustomize configuration (e.g. patches, common labels) to be applied to the generated policies. This also means that the policy generator can be integrated into existing GitOps processes that support Kustomize, such as RHACM Application Lifecycle Management and OpenShift GitOps (i.e. ArgoCD).</p>
</div>
<div class="paragraph">
<p>There are two Kustomize plugins, we refer to them as PolicyGenTool, but each has its own name and mission:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>SiteConfig Generator</strong>. Reads the SiteConfig manifest and generates the required Kubernetes manifests to run a RAN-enabled OpenShift deployment using RHACM. Code is located <a href="https://github.com/openshift-kni/cnf-features-deploy/tree/release-4.13/ztp/siteconfig-generator">here</a>.</p>
</li>
<li>
<p><strong>Policy Generator</strong>. Reads the PolicyGenTemplate manifest and generates the required Kubernetes manifest to configure an RHACM Policy targeting a set of clusters. Code is located <a href="https://github.com/openshift-kni/cnf-features-deploy/tree/release-4.13/ztp/policygenerator">here</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kustomize-plugins"><a class="anchor" href="#kustomize-plugins"></a>Kustomize Plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As we already said, PolicyGenTool is a collection of Kustomize plugins. Kustomize plugins work as described below.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When installing these tools in ArgoCD running on a hub cluster the configuration described in this section is handled automatically. The ArgoCD operator will find the plugin binaries and use them to generate CRs from SiteConfig and PolicyGenTemplates. This section is provided as background/reference.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The user has a path configured in Kustomize for plugins (defaults to <code>~/.config/kustomize/plugin/</code>), inside this path different folders are configured in a way that Kustomize can understand what plugin needs to be executed under which situation. Let&#8217;s explain this.</p>
</div>
<div class="paragraph">
<p>If we look at this <code>kustomization.yaml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
generators:
  - ztp-sno-lab.yaml
  - common-policies/common.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>We see that under <code>generators</code> section we have two yaml files, <em>generators</em> tell Kustomize that some plugin needs to be run to interpret these files. The way Kustomize knows which plugin needs to be executed is by looking at the <code>GroupVersionKind (GVK)</code> of the files. Following with above example we will see the following GVKs:</p>
</div>
<div class="paragraph">
<p><strong>ztp-sno-lab.yaml</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: ran.openshift.io/v1
kind: SiteConfig</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>common-policies/common.yaml</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: ran.openshift.io/v1
kind: PolicyGenTemplate</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we can see the group is <code>ran.openshift.io</code>, version is <code>v1</code> and kind are <code>SiteConfig</code> and <code>PolicyGenTemplate</code>.</p>
</div>
<div class="paragraph">
<p>Earlier, we talked about the Kustomzie plugins path, and how it is required to have a proper folder structure so Kustomize knows which plugin needs to be executed. Using the examples above we can explain what Kustomize will do for generating these two files.</p>
</div>
<div class="paragraph">
<p><strong>ztp-sno-lab.yaml</strong></p>
</div>
<div class="paragraph">
<p>Kustomize will get the GVK and after that will go to the plugins path and execute the plugin binary, the path for the binary is <code>$KUSTOMIZE_PLUGINS_PATH/&lt;group&gt;/&lt;version&gt;/&lt;kind&gt;/&lt;pluginbinary&gt;</code>. In this case Kustomize will execute the binary at <code>~/.config/kustomize/plugin/ran.openshift.io/v1/siteconfig/SiteConfig</code>.</p>
</div>
<div class="paragraph">
<p><strong>common-policies/common.yaml</strong></p>
</div>
<div class="paragraph">
<p>Kustomize will get the GVK and after that will go to the plugins path and execute the plugin binary, the path for the binary is <code>$KUSTOMIZE_PLUGINS_PATH/&lt;group&gt;/&lt;version&gt;/&lt;kind&gt;/&lt;pluginbinary&gt;</code>. In this case Kustomize will execute the binary at <code>~/.config/kustomize/plugin/ran.openshift.io/v1/policygentemplate/PolicyGenTemplate</code>.</p>
</div>
<div class="sect2">
<h3 id="siteconfig-generator"><a class="anchor" href="#siteconfig-generator"></a>SiteConfigGenerator</h3>
<div class="paragraph">
<p>The SiteConfigGenerator reads the SiteConfig manifest and uses the information provided in that file to output a set of manifests that will be used for running a cluster installation. The manifests templates can be found <a href="https://github.com/openshift-kni/cnf-features-deploy/blob/release-4.13/ztp/siteconfig-generator/siteConfig/clusterCRs.go">here</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="policy-generator"><a class="anchor" href="#policy-generator"></a>Policy Generator</h3>
<div class="paragraph">
<p>The PolicyGenerator reads the PolicyGenTemplate manifests and uses the information provided in these files to output a set of RHACM policies that will be used for different purposes, from day2ops to monitoring the cluster health. It makes use os templated policies that can be found <a href="https://github.com/openshift-kni/cnf-features-deploy/tree/release-4.13/ztp/source-crs">here</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
A high level view of the installation and configuration workflow can be found in the previous section <a href="ztp-workflow.html">ZTP workflow</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="5g-ran-profile"><a class="anchor" href="#5g-ran-profile"></a>5G RAN Profile</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Red Hat CNF team has crafted specific configurations to improve the performance on clusters running RAN workloads. All the configurations described below are expected to be present in a cluster where RAN workloads are expected to run.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Some of these configurations are configured at install time (through the use of extra-manifests during the installation) and others are configured through Policy automatically after the cluster joins the RHACM Hub.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/pgt_ran_du_profile.png" alt="validated vRAN DU profile">
</div>
</div>
<div class="paragraph">
<p>Above picture describes what areas are covered by the 5G Ran profile. Red Hat covers all layers but the two on the top which are part of the application domain. Below the different 5G RAN profile configurations are described.</p>
</div>
<div class="paragraph">
<p>A more in-detail explanation of the 5G RAN Profile is covered in this <a href="https://videos.learning.redhat.com/media/CNF+RAN+validated+pattern/1_x32rfqrs/253048913">training material</a>.</p>
</div>
<div class="sect2">
<h3 id="workload-partitioning"><a class="anchor" href="#workload-partitioning"></a>Workload Partitioning</h3>
<div class="paragraph">
<p>Pins OCP platform, operating system processes and day2 operator Pods that are part of the DU profile to the reserved cpuset.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/openshift-kni/cnf-features-deploy/blob/release-4.13/ztp/source-crs/extra-manifest/workload/03-workload-partitioning.yaml">Manifest</a></p>
</div>
</div>
<div class="sect2">
<h3 id="kubelet-tuning"><a class="anchor" href="#kubelet-tuning"></a>Kubelet Tuning</h3>
<div class="paragraph">
<p>Reduce frequency of kubelet housekeeping and eviction monitoring to reduce CPU usage.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/openshift-kni/cnf-features-deploy/blob/release-4.13/ztp/source-crs/extra-manifest/01-container-mount-ns-and-kubelet-conf-master.yaml">Manifest</a></p>
</div>
</div>
<div class="sect2">
<h3 id="sctp"><a class="anchor" href="#sctp"></a>SCTP</h3>
<div class="paragraph">
<p>Enable SCTP kernel module which is required by RAN applications but disabled by default in RHCOS.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/openshift-kni/cnf-features-deploy/blob/release-4.13/ztp/source-crs/extra-manifest/03-sctp-machine-config-master.yaml">Manifest</a></p>
</div>
</div>
<div class="sect2">
<h3 id="hide-container-mount"><a class="anchor" href="#hide-container-mount"></a>Container Mount Hiding</h3>
<div class="paragraph">
<p>In order to reduce system mount scanning overhead, creates a mount namespaces for container mounts visible to kubelet/CRI-O.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/openshift-kni/cnf-features-deploy/blob/release-4.13/ztp/source-crs/extra-manifest/01-container-mount-ns-and-kubelet-conf-master.yaml">Manifest</a></p>
</div>
</div>
<div class="sect2">
<h3 id="recovery-optimization"><a class="anchor" href="#recovery-optimization"></a>Recovery Optimization</h3>
<div class="paragraph">
<p>Systemd service which will assign additional CPUs to systemd services during reboot recovery.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/openshift-kni/cnf-features-deploy/blob/release-4.13/ztp/source-crs/extra-manifest/04-accelerated-container-startup-master.yaml">Manifest</a></p>
</div>
</div>
<div class="sect2">
<h3 id="monitoring-footprint"><a class="anchor" href="#monitoring-footprint"></a>Monitoring Operator Config</h3>
<div class="paragraph">
<p>Reduce footprint of the monitoring stack by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reducing the Prometheus retention period, metrics are already being aggregated at the RHACM hub.</p>
</li>
<li>
<p>Disable local Grafana and Alertmanager.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="https://github.com/openshift-kni/cnf-features-deploy/blob/release-4.13/ztp/source-crs/ReduceMonitoringFootprint.yaml">Manifest</a></p>
</div>
</div>
<div class="sect2">
<h3 id="ocp-console"><a class="anchor" href="#ocp-console"></a>Console Operator</h3>
<div class="paragraph">
<p>As part of the composable OpenShift Settings the Console Operator can be enabled-disabled. The <code>SiteConfig</code> CR allows to define these settings via the <code>installConfigOverrides</code>.</p>
</div>
<div class="paragraph">
<p>Since the DUs are being centrally managed from a RHACM hub, the local console will be disabled to reduce resource consumption.</p>
</div>
</div>
<div class="sect2">
<h3 id="networking-diags"><a class="anchor" href="#networking-diags"></a>Networking Operator</h3>
<div class="paragraph">
<p>Disable networking diagnostics for SNO as it is not applicable.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/openshift-kni/cnf-features-deploy/blob/release-4.13/ztp/source-crs/DisableSnoNetworkDiag.yaml">Manifest</a></p>
</div>
</div>
<div class="sect2">
<h3 id="operatorhub"><a class="anchor" href="#operatorhub"></a>OperatorHub</h3>
<div class="paragraph">
<p>A single catalog source is recommended that contains only the operators required for a RAN DU deployment.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/openshift-kni/cnf-features-deploy/blob/release-4.13/ztp/source-crs/OperatorHub.yaml">Manifest 1</a></p>
</div>
<div class="paragraph">
<p><a href="https://github.com/openshift-kni/cnf-features-deploy/blob/release-4.13/ztp/source-crs/DefaultCatsrc.yaml">Manifest 2</a></p>
</div>
</div>
<div class="sect2">
<h3 id="ptp-operator"><a class="anchor" href="#ptp-operator"></a>PTP Operator</h3>
<div class="paragraph">
<p>Configuration of the Precision Time Protocol. The DU can run in the following modes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ordinary clock sync to a GM or boundary clock.</p>
</li>
<li>
<p>In addition to the above optionally provide a boundary clock for RU.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This also includes an optional event notification service that applications can subscribe to for ptp events.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/openshift-kni/cnf-features-deploy/blob/release-4.13/ztp/source-crs/PtpConfigSlave.yaml">Ordinary Clock Manifest</a></p>
</div>
<div class="paragraph">
<p><a href="https://github.com/openshift-kni/cnf-features-deploy/blob/release-4.13/ztp/source-crs/PtpConfigMaster.yaml">Boundary Clock Manifest</a></p>
</div>
<div class="paragraph">
<p><a href="https://github.com/openshift-kni/cnf-features-deploy/blob/release-4.13/ztp/source-crs/PtpOperatorConfigForEvent.yaml">Event Notification Manifest</a></p>
</div>
</div>
<div class="sect2">
<h3 id="sr-iov"><a class="anchor" href="#sr-iov"></a>SR-IOV</h3>
<div class="paragraph">
<p>Provision and configure the SR-IOV CNI and device plugin. Both netdevice (kernel VFs) and vfio (DPDK) are supported.</p>
</div>
<div class="paragraph">
<p>This will be customer specific.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/openshift-kni/cnf-features-deploy/blob/release-4.13/ztp/source-crs/SriovOperatorConfig.yaml">Operator Config Manifest</a></p>
</div>
<div class="paragraph">
<p><a href="https://github.com/openshift-kni/cnf-features-deploy/blob/release-4.13/ztp/source-crs/SriovNetworkNodePolicy.yaml">SriovNetworkPolicy Manifest</a></p>
</div>
<div class="paragraph">
<p><a href="https://github.com/openshift-kni/cnf-features-deploy/blob/release-4.13/ztp/source-crs/SriovNetwork.yaml">SriovNetwork Manifest</a></p>
</div>
</div>
<div class="sect2">
<h3 id="nto"><a class="anchor" href="#nto"></a>Node Tuning Operator</h3>
<div class="paragraph">
<p>Performance Tuning interface including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enables RT kernel.</p>
</li>
<li>
<p>Enables kubelet feature (cpu manager, topology manager, memory manager).</p>
</li>
<li>
<p>Configures huge pages.</p>
</li>
<li>
<p>Configures reserved and isolated cpusets.</p>
</li>
<li>
<p>Additional kernel args.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="https://github.com/openshift-kni/cnf-features-deploy/blob/release-4.13/ztp/source-crs/PerformanceProfile.yaml">Manifest</a></p>
</div>
</div>
<div class="sect2">
<h3 id="local-storage"><a class="anchor" href="#local-storage"></a>Local Storage</h3>
<div class="paragraph">
<p>Enables creation of Persistent Volumes which can be consumed as PVCs by applications. This will be customer specific.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/openshift-kni/cnf-features-deploy/blob/release-4.13/ztp/source-crs/StorageClass.yaml">StorageClass Manifest</a>
<a href="https://github.com/openshift-kni/cnf-features-deploy/blob/release-4.13/ztp/source-crs/StorageLV.yaml">Storage Local Volume Manifest</a>
<a href="https://github.com/openshift-kni/cnf-features-deploy/blob/release-4.13/ztp/source-crs/StorageLVMCluster.yaml">Storage Local Volume Manifest Dynamic Provisioning</a></p>
</div>
</div>
<div class="sect2">
<h3 id="logs"><a class="anchor" href="#logs"></a>Log Collector and Forwarder</h3>
<div class="paragraph">
<p>Enables collection and shipping of logs off the edge node for remote analysis.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/openshift-kni/cnf-features-deploy/blob/release-4.13/ztp/source-crs/ClusterLogForwarder.yaml">Manifest</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="siteconfig-templating"><a class="anchor" href="#siteconfig-templating"></a>SiteConfig Templating</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The SiteConfig templating is pretty straightforward, whatever information we put into our SiteConfig manifest will be translated to the required manifests to initiate the cluster installation. You can find a SiteConfig example <a href="https://github.com/openshift-kni/cnf-features-deploy/blob/release-4.13/ztp/gitops-subscriptions/argocd/example/siteconfig/example-sno.yaml">here</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="policies-templating"><a class="anchor" href="#policies-templating"></a>Policies Templating</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Policies templating is a bit different, we have a set of base configuration CRs, known as source-crs, that we can use. This set of CRs can be found <a href="https://github.com/openshift-kni/cnf-features-deploy/tree/release-4.13/ztp/source-crs">here</a>.</p>
</div>
<div class="paragraph">
<p>If you access this link you will see lots of files, like for example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AcceleratorNS.yaml</p>
</li>
<li>
<p>AmqInstance.yaml</p>
</li>
<li>
<p>etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These CRs are referenced (by filename) from the PolicyGenTemplate CRs in Git. The PolicyGenTemplate CRs act as a manifest of which configuration CRs should be included and how they should be combined into Policy CRs. In addition, the PolicyGenTemplate can contain an "overlay" (or patch) that is applied to the CR before it is wrapped into the Policy.</p>
</div>
<div class="paragraph">
<p>The way this works is a follows. We will have one or more PolicyGenTemplates where we will reference these base configuration CRs. We can see an example <a href="https://github.com/openshift-kni/cnf-features-deploy/blob/release-4.13/ztp/gitops-subscriptions/argocd/example/policygentemplates/group-du-standard-ranGen.yaml">here</a>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s use the following PolicyGenTemplate as example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: ran.openshift.io/v1
kind: PolicyGenTemplate
metadata:
 name: "test"
 namespace: "test"
spec:
  bindingRules:
    test: "true"
  mcp: "master"
  sourceFiles:
    - fileName: SriovOperatorConfig.yaml
      policyName: "config-policy"
    - fileName: PerformanceProfile.yaml
      policyName: "config-policy"
      spec:
        cpu:
          isolated: "2-19,22-39"
          reserved: "0-1,20-21"
        hugepages:
          defaultHugepagesSize: 1G
          pages:
            - size: 1G
              count: 32</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can see that the PolicyGenTemplate is targeting two base configuration CRs: <code>SriovOperatorConfig.yaml</code> and <code>PerformanceProfile.yaml</code>.</p>
</div>
<div class="paragraph">
<p>The first source CR, <code>SriovOperatorConfig.yaml</code>, is not overriding any settings, we can tell this because we don&#8217;t have a <code>spec</code> or <code>metadata</code> section below the <code>policyName</code>. That means that the final policy will include the configuration CR without modification ( <a href="https://github.com/openshift-kni/cnf-features-deploy/blob/release-4.13/ztp/source-crs/SriovOperatorConfig.yaml">base SriovOperatorConfig configuration CR</a>).</p>
</div>
<div class="paragraph">
<p>The second source CR, <code>PerformanceProfile.yaml</code>, is overriding some parameters in the <code>spec</code>. That means that the final policy will be configured as a merge of the <a href="https://github.com/openshift-kni/cnf-features-deploy/blob/release-4.13/ztp/source-crs/PerformanceProfile.yaml">original CR</a> plus the custom overrides we provided in the PolicyGenTemplate.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Inside the templates we can often see references to what may appear variables like <code>$size</code>, <code>$count</code>, etc. These are not vars, that actually tells the policyGen plugin to remove that line from the output if no value was provided as an override. The only variable that is referenced and is actually substituted is the <code>$mcp</code> variable that will be replaced with the value of the same property defined in the PolicyGenTemplate.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kustomize-plugins-locally"><a class="anchor" href="#kustomize-plugins-locally"></a>Running Kustomize Plugins Locally</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We have described how Argo CD makes use of the PolicyGenTool plugins to generate the required manifests for our 5G RAN deployments. In this section, we are going to cover how to run these plugins locally which can be useful while troubleshooting or getting a preview of what the files will look like when generated via Argo CD.</p>
</div>
<div class="paragraph">
<p>By running the steps below we will get the plugins installed in our system. Kustomize should be already installed, you can get it from the <a href="https://github.com/kubernetes-sigs/kustomize/releases/">releases page</a>.</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mkdir -p ~/.config/kustomize/plugin
podman cp $(podman create --name policgentool --rm registry.redhat.io/openshift4/ztp-site-generate-rhel8:v4.13):/kustomize/plugin/ran.openshift.io ~/.config/kustomize/plugin/
podman rm -f policgentool</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that we have the plugins locally we can run them:</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
We need to enable the alpha plugins by using the parameter <code>--enable-alpha-plugins</code>
</td>
</tr>
</table>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kustomize build site-configs/ --enable-alpha-plugins</code></pre>
</div>
</div>
<div class="paragraph">
<p>We will get the output (manifests that will be consumed by the RHACM Hub).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: v1
kind: Namespace
metadata:
  annotations:
    argocd.argoproj.io/sync-wave: "0"
    ran.openshift.io/ztp-gitops-generated: '{}'
  labels:
    name: ztp-sno
  name: ztp-sno
---
apiVersion: v1
data:
  03-workload-partitioning.yaml: |
    apiVersion: machineconfiguration.openshift.io/v1
    kind: MachineConfig
    metadata:
        annotations:
&lt;OUTPUT_OMITTED&gt;</code></pre>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="talm.html">Topology Aware Lifecycle Manager (TALM)</a></span>
  <span class="next"><a href="integration-with-aap.html">Integration with Ansible Automation Platform</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
